<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Online Store with Stripe Payment - Dark Mode</title>
  <script src="https://js.stripe.com/v3/"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      transition: background-color 0.3s ease, color 0.3s ease;
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

  <!-- Navigation Bar -->
  <header class="fixed top-0 left-0 w-full bg-gray-800 dark:bg-gray-900 text-white flex justify-between items-center px-6 py-3 shadow z-50">
    <a href="#" class="flex items-center space-x-3">
      <img src="images/logo.png" alt="Logo" class="h-10 w-10 object-contain">
      <span class="text-xl font-semibold">My Online Store</span>
    </a>
    <button id="theme-toggle" class="bg-gray-700 hover:bg-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600 rounded px-3 py-1 text-sm">Dark Mode</button>
  </header>

  <!-- Content Wrapper -->
  <div class="pt-20 flex flex-col md:flex-row max-w-7xl mx-auto px-6 min-h-screen">

    <!-- Products -->
    <main class="w-full md:w-3/4">
      <h1 class="text-3xl font-bold mb-4">Product Catalog</h1>
      <input id="search-input" type="text" placeholder="Search products..." class="mb-6 w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100">
      <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </main>

    <!-- Cart & Checkout -->
    <aside class="w-full md:w-1/4 bg-white dark:bg-gray-800 p-6 border-t md:border-t-0 md:border-l border-gray-200 dark:border-gray-700 shadow-lg sticky top-20 h-full overflow-auto">
      <h2 class="text-2xl font-semibold mb-4">Shopping Cart</h2>
      <div id="cart-items" class="space-y-2 mb-4"></div>
      <p class="text-xl font-bold">Total: $<span id="cart-total">0.00</span></p>

      <div id="card-element" class="mb-4 p-2 border rounded dark:bg-gray-700 dark:border-gray-600"></div>
      <div id="card-errors" class="text-red-600 mb-4 min-h-[1.25rem]"></div>

      <button id="checkout-btn" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded" disabled>Checkout</button>

      <div id="payment-message" class="mt-4 text-center font-semibold"></div>
    </aside>
  </div>

  <script>
    const themeToggleBtn = document.getElementById('theme-toggle');
    const htmlElement = document.documentElement;

    if (localStorage.getItem('theme') === 'dark' ||
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      htmlElement.classList.add('dark');
      themeToggleBtn.textContent = 'Light Mode';
    }

    themeToggleBtn.addEventListener('click', () => {
      if (htmlElement.classList.contains('dark')) {
        htmlElement.classList.remove('dark');
        themeToggleBtn.textContent = 'Dark Mode';
        localStorage.setItem('theme', 'light');
      } else {
        htmlElement.classList.add('dark');
        themeToggleBtn.textContent = 'Light Mode';
        localStorage.setItem('theme', 'dark');
      }
    });

    const stripe = Stripe("pk_test_XXXXXXXXXXXXXXXXXXXXXXXX"); // Replace with your real public key
    const elements = stripe.elements();
    const card = elements.create('card', { hidePostalCode: true });
    card.mount('#card-element');
    card.on('change', event => {
      document.getElementById('card-errors').textContent = event.error ? event.error.message : '';
    });

    const products = [
      { id: 1, name: "Wireless Headphones", price: 5999, description: "High-quality sound with noise cancellation.", image: "https://via.placeholder.com/200x150" },
      { id: 2, name: "Smart Watch", price: 9999, description: "Track your fitness and notifications.", image: "https://via.placeholder.com/200x150" },
      { id: 3, name: "Bluetooth Speaker", price: 3999, description: "Portable speaker with powerful sound.", image: "https://via.placeholder.com/200x150" },
      { id: 4, name: "USB-C Charger", price: 1999, description: "Fast charging USB-C wall adapter.", image: "https://via.placeholder.com/200x150" },
      { id: 5, name: "Laptop Stand", price: 2999, description: "Adjustable aluminum laptop stand.", image: "https://via.placeholder.com/200x150" }
    ];

    let cart = [];
    const productGrid = document.getElementById("product-grid");
    const cartItems = document.getElementById("cart-items");
    const cartTotal = document.getElementById("cart-total");
    const checkoutBtn = document.getElementById("checkout-btn");
    const paymentMessage = document.getElementById("payment-message");

    function renderProducts(productsToRender) {
      productGrid.innerHTML = "";
      productsToRender.forEach(product => {
        const div = document.createElement("div");
        div.className = "bg-white dark:bg-gray-700 p-4 rounded-lg shadow-md flex flex-col";
        div.innerHTML = `
          <img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover rounded mb-4">
          <h3 class="text-xl font-semibold">${product.name}</h3>
          <p class="text-gray-600 dark:text-gray-300 flex-grow">${product.description}</p>
          <p class="mt-2 text-lg font-bold">$${(product.price / 100).toFixed(2)}</p>
          <button class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Add to Cart</button>
        `;
        div.querySelector("button").addEventListener("click", () => addToCart(product));
        productGrid.appendChild(div);
      });
    }

    function updateCart() {
      cartItems.innerHTML = "";
      let total = 0;
      if (cart.length === 0) {
        cartItems.innerHTML = `<p class="text-gray-500 italic dark:text-gray-400">Your cart is empty.</p>`;
      } else {
        cart.forEach(item => {
          const div = document.createElement("div");
          div.className = "flex justify-between items-center border-b border-gray-200 dark:border-gray-600 pb-2";
          div.innerHTML = `
            <div>
              <span class="font-medium">${item.name}</span><br>
              <small>$${(item.price / 100).toFixed(2)} x ${item.quantity}</small>
            </div>
            <div class="flex items-center space-x-2">
              <button class="decrement text-gray-600 dark:text-gray-300 px-2 border border-gray-400">âˆ’</button>
              <span>${item.quantity}</span>
              <button class="increment text-gray-600 dark:text-gray-300 px-2 border border-gray-400">+</button>
              <button class="remove text-red-600 dark:text-red-400 ml-3">Remove</button>
            </div>
          `;
          div.querySelector(".decrement").addEventListener("click", () => {
            if (item.quantity > 1) item.quantity--;
            else cart = cart.filter(i => i.id !== item.id);
            updateCart();
          });
          div.querySelector(".increment").addEventListener("click", () => {
            item.quantity++;
            updateCart();
          });
          div.querySelector(".remove").addEventListener("click", () => {
            cart = cart.filter(i => i.id !== item.id);
            updateCart();
          });
          cartItems.appendChild(div);
          total += item.price * item.quantity;
        });
      }
      cartTotal.textContent = (total / 100).toFixed(2);
      checkoutBtn.disabled = total === 0;
      paymentMessage.textContent = "";
    }

    function addToCart(product) {
      const existing = cart.find(i => i.id === product.id);
      if (existing) existing.quantity++;
      else cart.push({ ...product, quantity: 1 });
      updateCart();
    }

    document.getElementById("search-input").addEventListener("input", e => {
      const searchTerm = e.target.value.toLowerCase();
      const filtered = products.filter(p => p.name.toLowerCase().includes(searchTerm) || p.description.toLowerCase().includes(searchTerm));
      renderProducts(filtered);
    });

    checkoutBtn.addEventListener("click", async () => {
      const amount = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      paymentMessage.textContent = "Processing payment...";
      paymentMessage.className = "mt-4 text-center font-semibold text-blue-600";

      try {
        const res = await fetch("https://your-backend-url.com/create-payment-intent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount })
        });
        const { clientSecret, error } = await res.json();

        if (error) throw new Error(error);

        const result = await stripe.confirmCardPayment(clientSecret, {
          payment_method: { card }
        });

        if (result.error) throw result.error;

        if (result.paymentIntent.status === "succeeded") {
          paymentMessage.textContent = "Payment successful! Thank you for your purchase.";
          paymentMessage.className = "text-green-600 mt-4 font-semibold text-center";
          cart = [];
          updateCart();
          card.clear();
        }
      } catch (err) {
        paymentMessage.textContent = "Payment failed: " + err.message;
        paymentMessage.className = "text-red-600 mt-4 font-semibold text-center";
      }
    });

    renderProducts(products);
    updateCart();
  </script>
</body>
</html>
