<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Online Store with Stripe Payment</title>
  <script src="https://js.stripe.com/v3/"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100">

  <!-- Sticky Navigation Bar -->
  <header class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
      <a href="#" class="flex items-center space-x-3">
        <!-- Logo image must be in images/logo.png relative to index.html -->
        <img src="images/logo.png" alt="Logo" class="h-10 w-auto" />
        <span class="text-2xl font-bold text-gray-800">My Online Store</span>
      </a>

      <nav class="space-x-6 text-gray-700 font-medium">
        <a href="#" class="hover:text-blue-600 transition">Home</a>
        <a href="#product-grid" class="hover:text-blue-600 transition">Products</a>
        <a href="#about" class="hover:text-blue-600 transition">About</a>
        <a href="#contact" class="hover:text-blue-600 transition">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Push page content down to compensate for fixed navbar height -->
  <div class="pt-20 flex flex-col md:flex-row min-h-screen">

    <!-- Product Section -->
    <div class="w-full md:w-3/4 p-6">
      <h1 id="product-grid" class="text-3xl font-bold mb-4">Product Catalog</h1>
      <input
        id="search-input"
        type="text"
        placeholder="Search products..."
        class="mb-6 w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
    </div>

    <!-- Cart and Payment Section -->
    <div class="w-full md:w-1/4 bg-white p-6 border-t md:border-t-0 md:border-l shadow-lg sticky top-20 h-full overflow-auto">
      <h2 class="text-2xl font-semibold mb-4">Shopping Cart</h2>
      <div id="cart-items" class="space-y-2 mb-4"></div>
      <p class="text-xl font-bold">Total: $<span id="cart-total">0.00</span></p>

      <!-- Stripe Card Element -->
      <div id="card-element" class="mb-4 p-2 border rounded"></div>
      <div id="card-errors" role="alert" class="text-red-600 mb-4 min-h-[1.25rem]"></div>

      <button id="checkout-btn" class="mt-4 w-full bg-green-600 text-white py-2 rounded hover:bg-green-700" disabled>Checkout</button>

      <div id="payment-message" class="mt-4 text-center font-semibold"></div>
    </div>
  </div>

  <script>
    const stripe = Stripe("pk_test_51RWMZ0Qqk6nCKA6s7vfs81QCZTGJTbMft8fttS09StP3TymTUNtEkEgfTK8octPO1qxmn7OwE42H0xDGinr06bZJ00MLIsuHwQ");

    const products = [
      { id: 1, name: "Wireless Headphones", price: 5999, description: "High-quality sound with noise cancellation.", image: "https://via.placeholder.com/200x150" },
      { id: 2, name: "Smart Watch", price: 9999, description: "Track your fitness and notifications.", image: "https://via.placeholder.com/200x150" },
      { id: 3, name: "Bluetooth Speaker", price: 3999, description: "Portable speaker with powerful sound.", image: "https://via.placeholder.com/200x150" },
      { id: 4, name: "USB-C Charger", price: 1999, description: "Fast charging USB-C wall adapter.", image: "https://via.placeholder.com/200x150" },
      { id: 5, name: "Laptop Stand", price: 2999, description: "Adjustable aluminum laptop stand.", image: "https://via.placeholder.com/200x150" }
    ];

    let cart = [];
    const productGrid = document.getElementById("product-grid");
    const cartItems = document.getElementById("cart-items");
    const cartTotal = document.getElementById("cart-total");
    const checkoutBtn = document.getElementById("checkout-btn");
    const paymentMessage = document.getElementById("payment-message");
    const cardErrors = document.getElementById("card-errors");

    // Initialize Stripe Elements
    const elements = stripe.elements();
    const card = elements.create('card', {hidePostalCode: true});
    card.mount('#card-element');

    // Handle card element errors
    card.on('change', event => {
      if (event.error) {
        cardErrors.textContent = event.error.message;
      } else {
        cardErrors.textContent = '';
      }
    });

    function renderProducts(productsToRender) {
      productGrid.innerHTML = "";
      productsToRender.forEach(product => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "bg-white p-4 rounded-lg shadow-md flex flex-col";
        cardDiv.innerHTML = `
          <img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover rounded mb-4" />
          <h3 class="text-xl font-semibold">${product.name}</h3>
          <p class="text-gray-600 flex-grow">${product.description}</p>
          <p class="mt-2 text-lg font-bold">$${(product.price/100).toFixed(2)}</p>
          <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add to Cart</button>
        `;
        cardDiv.querySelector("button").addEventListener("click", () => addToCart(product));
        productGrid.appendChild(cardDiv);
      });
    }

    function updateCart() {
      cartItems.innerHTML = "";
      let total = 0;

      if (cart.length === 0) {
        cartItems.innerHTML = `<p class="text-gray-500 italic">Your cart is empty.</p>`;
      } else {
        cart.forEach(item => {
          const div = document.createElement("div");
          div.className = "flex justify-between items-center border-b pb-2";

          div.innerHTML = `
            <div>
              <span class="font-medium">${item.name}</span><br>
              <small>$${(item.price/100).toFixed(2)} x ${item.quantity}</small>
            </div>
            <button class="text-red-600 hover:underline">Remove</button>
          `;
          div.querySelector("button").addEventListener("click", () => removeFromCart(item.id));
          cartItems.appendChild(div);

          total += item.price * item.quantity;
        });
      }

      cartTotal.textContent = (total / 100).toFixed(2);
      checkoutBtn.disabled = total === 0;
      paymentMessage.textContent = "";
      cardErrors.textContent = '';
    }

    function addToCart(product) {
      const found = cart.find(item => item.id === product.id);
      if (found) {
        found.quantity++;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      updateCart();
    }

    function removeFromCart(id) {
      cart = cart.filter(item => item.id !== id);
      updateCart();
    }

    document.getElementById("search-input").addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      const filtered = products.filter(p => p.name.toLowerCase().includes(term) || p.description.toLowerCase().includes(term));
      renderProducts(filtered);
    });

    checkoutBtn.addEventListener("click", async () => {
      const amount = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

      paymentMessage.textContent = "Processing payment...";
      paymentMessage.className = "mt-4 text-center font-semibold text-blue-600";

      try {
        const response = await fetch("https://your-backend-url.com/create-payment-intent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount })
        });

        const data = await response.json();

        if (data.error) {
          paymentMessage.textContent = data.error;
          paymentMessage.className = "text-red-600 mt-4 font-semibold text-center";
          return;
        }

        const clientSecret = data.clientSecret;

        const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
          payment_method: {
            card: card,
          }
        });

        if (error) {
          paymentMessage.textContent = error.message;
          paymentMessage.className = "text-red-600 mt-4 font-semibold text-center";
        } else if (paymentIntent && paymentIntent.status === 'succeeded') {
          paymentMessage.textContent = "Payment successful! Thank you for your purchase.";
          paymentMessage.className = "text-green-600 mt-4 font-semibold text-center";
          cart = [];
          updateCart();
          card.clear();
        }
      } catch (err) {
        paymentMessage.textContent = "Payment failed: " + err.message;
        paymentMessage.className = "text-red-600 mt-4 font-semibold text-center";
      }
    });

    renderProducts(products);
    updateCart();
  </script>

  <!-- Placeholder About and Contact sections -->
  <section id="about" class="max-w-7xl mx-auto px-6 py-12 mt-12">
    <h2 class="text-3xl font-bold mb-4">About Us</h2>
    <p class="text-gray-700">Welcome to My Online Store. We provide quality products and excellent customer service.</p>
  </section>

  <section id="contact" class="max-w-7xl mx-auto px-6 py-12 mt-12">
    <h2 class="text-3xl font-bold mb-4">Contact Us</h2>
    <p class="text-gray-700">You can reach us at contact@myonlinestore.com or call (123) 456-7890.</p>
  </section>

</body>
</html>
